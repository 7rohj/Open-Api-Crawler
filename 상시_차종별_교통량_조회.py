# -*- coding: utf-8 -*-
"""ìƒì‹œ ì°¨ì¢…ë³„ êµí†µëŸ‰ ì¡°íšŒ

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1nHA4xmdZGfxUW0Ej4k1sqMexandC3nMc

## ìƒì‹œ ì°¨ì¢…ë³„ êµí†µëŸ‰ ì¡°íšŒ

ìƒì‹œ ìˆ˜ì§‘ëœ êµí†µ ë°ì´í„° ì¤‘ ì—°ë„, ë„ë¡œ ì¢…ë¥˜ë¥¼ í†µí•´ ì§€ì •í•œ <br/>
ì—°ë„ì— ì„ íƒëœ ë„ë¡œ(ê³ ì†ë„ë¡œ, ì¼ë°˜ë„ë¡œ ë“±)ë¥¼ í†µí–‰í•œ ì°¨ëŸ‰ ì¢…ë¥˜ë³„ í†µí–‰ëŸ‰ì„ <br/> ì¡°íšŒí•˜ëŠ” ê¸°ëŠ¥

https://www.data.go.kr/iim/api/selectAPIAcountView.do
"""

! pip install xmltodict

"""### ì˜¤ë¥˜ê°€ ì™œ ëœ¨ëŠ”ì§€ í™•ì¸ ì½”ë“œ"""

import json

def parse_re(input_re: str):
    try:
        return_dict = json.loads(input_re)
    except json.decoder.JSONDecodeError:
        return_dict = dict()
    finally:
        return return_dict

i = 0
url = 'http://apis.data.go.kr/1613000/KICTopenAPI/vt?serviceKey=LGp4ONLLefBCX516C1Cg%2B6LeQEDqU8iKsXZM9nxG0zPoZ61jkjo9tHIBdJXXoeEzPlJMEqi6SlIvRHYrNU12cA%3D%3D&year=2020&dtype=2&output=json&pageNo={}'.format(i) + '&month=1&numOfRows=500&type=json'

# url ë¶ˆëŸ¬ì˜¤ê¸°
response = requests.get(url) # ì‹ ë¢°í•  ìˆ˜ ì—†ëŠ” SSL ì¸ì¦ì„œë¡œ ì¸í•´ ë°œìƒ, verify=False êµ¬ë¬¸ ì¶”ê°€

# ë°ì´í„° ê°’ ì¶œë ¥í•´ë³´ê¸°
contents = response.text

# ë¬¸ìì—´ì„ jsonìœ¼ë¡œ ë³€ê²½
#json_ob = json.loads(contents) ## dtype 2ì—ì„œ ì—¬ê¸°ì„œ ì—ëŸ¬ëœ¸
print(parse_re(contents))

"""ì™œ {} ê°€ ë‚˜ì˜¤ëŠ”ì§€?"""

import pandas as pd
from pandas.io.json import json_normalize
import requests
import pprint
import json

# url ì…ë ¥ (https ë§ê³  httpë¡œ ìˆ˜ì •)

#dtype=1,month=1
#count=6174
#pageNo=13
#numOfRows=500

#dtype=1,month=2
#count=6148
#pageNo=13
#numOfRows=500

#dtype=1,month=3
#count=6790
#pageNo=14
#numOfRows=500

#dtype=1,month=4
#count=6908
#pageNo=14
#numOfRows=500

#dtype=1,month=5
#count=7148
#pageNo=15
#numOfRows=500

#dtype=1,month=6
#count=6994
#pageNo=14
#numOfRows=500

#dtype=1,month=7
#count=7166
#pageNo=15
#numOfRows=500

#dtype=1,month=8
#count=7022
#pageNo=15
#numOfRows=500

#dtype=1,month=9
#count=6446
#pageNo=13
#numOfRows=500

#dtype=1,month=10
#count=6562
#pageNo=14
#numOfRows=500

#dtype=1,month=11
#count=6234
#pageNo=13
#numOfRows=500

#dtype=1,month=12
#count=6598
#pageNo=14
#numOfRows=500

dataframe = pd.DataFrame(columns=['spot_id', 'month', 'day', 'direction', 'vehicle_type1', 'vehicle_type2',
       'vehicle_type3', 'vehicle_type4', 'vehicle_type5', 'vehicle_type6',
       'vehicle_type7', 'vehicle_type8', 'vehicle_type9', 'vehicle_type10',
       'vehicle_type11', 'vehicle_type12', 'total_count'])

# list = [0,1,2,3,4,5] 
## spothcv -> vt

for i in range(14):
  url = 'http://apis.data.go.kr/1613000/KICTopenAPI/vt?serviceKey=LGp4ONLLefBCX516C1Cg%2B6LeQEDqU8iKsXZM9nxG0zPoZ61jkjo9tHIBdJXXoeEzPlJMEqi6SlIvRHYrNU12cA%3D%3D&year=2020&dtype=1&output=json&pageNo={}'.format(i) + '&month=12&numOfRows=500&type=json'
  # url ë¶ˆëŸ¬ì˜¤ê¸°
  response = requests.get(url) # ì‹ ë¢°í•  ìˆ˜ ì—†ëŠ” SSL ì¸ì¦ì„œë¡œ ì¸í•´ ë°œìƒ, verify=False êµ¬ë¬¸ ì¶”ê°€

  # ë°ì´í„° ê°’ ì¶œë ¥í•´ë³´ê¸°
  contents = response.text

  # ë¬¸ìì—´ì„ jsonìœ¼ë¡œ ë³€ê²½
  #json_ob = json.loads(contents) ## dtype 2ì—ì„œ ì—¬ê¸°ì„œ ì—ëŸ¬ëœ¸
  json_ob = parse_re(contents)

  # í•„ìš”í•œ ë¶€ë¶„ë§Œ ì¶”ì¶œ
  body = json_ob['traffic']

  # ë°ì´í„°í”„ë ˆì„ìœ¼ë¡œ ë³€í™˜
  dataframe_i = json_normalize(body)

  # ë°ì´í„°í”„ë ˆì„ append
  dataframe = dataframe.append(dataframe_i)
  dataframe = dataframe.reset_index(drop=True)

dataframe

dataframe.to_csv('totalcount_vehicle_12.csv',index=False)

dataframe1 = pd.read_csv('totalcount_vehicle.csv')
dataframe2 = pd.read_csv('totalcount_vehicle_2.csv')
dataframe3 = pd.read_csv('totalcount_vehicle_3.csv')
dataframe4 = pd.read_csv('totalcount_vehicle_4.csv')
dataframe5 = pd.read_csv('totalcount_vehicle_5.csv')
dataframe6 = pd.read_csv('totalcount_vehicle_6.csv')
dataframe7 = pd.read_csv('totalcount_vehicle_7.csv')
dataframe8 = pd.read_csv('totalcount_vehicle_8.csv')
dataframe9 = pd.read_csv('totalcount_vehicle_9.csv')
dataframe10 = pd.read_csv('totalcount_vehicle_10.csv')
dataframe11 = pd.read_csv('totalcount_vehicle_11.csv')
dataframe12 = pd.read_csv('totalcount_vehicle_12.csv')

totalcount_vehicle2020 = pd.concat([dataframe1,dataframe2,dataframe3,dataframe5,
                                    dataframe6,dataframe7,dataframe8,dataframe9,dataframe10,dataframe11,dataframe12])
totalcount_vehicle2020 = totalcount_vehicle2020.reset_index(drop=True)
totalcount_vehicle2020 # 73282 * 17

"""#### ì¹¼ëŸ¼ ì¶”ê°€"""

totalcount_vehicle2020['dtype'] = 1
totalcount_vehicle2020

totalcount_vehicle2020.to_csv('totalcount_vehicle2020.csv',index=False)

"""## ğŸ¤¸â€â™€ï¸

## dtype = 2

counts êµ¬í•´ì£¼ê³  countslistì— ë‹´ê¸°

3ì›”ë§Œ <returnAuthMsg>LIMITED_NUMBER_OF_SERVICE_REQUESTS_EXCEEDS_ERROR</returnAuthMsg> ì˜¤ë¥˜ëœ¬ë‹¤. í™”ë‚˜ë„¤ <br/>
ì„œë²„ ë¬¸ì œì¸ë‘¡ ã…¡ã…¡^
"""

import pandas as pd
from pandas.io.json import json_normalize
import requests
import pprint
import json

countslist = []

i = 1

for j in range(1,13): #month

  url = 'http://apis.data.go.kr/1613000/KICTopenAPI/vt?serviceKey=LGp4ONLLefBCX516C1Cg%2B6LeQEDqU8iKsXZM9nxG0zPoZ61jkjo9tHIBdJXXoeEzPlJMEqi6SlIvRHYrNU12cA%3D%3D&year=2020&dtype=2&output=json&pageNo={}'.format(i) + '&month={}'.format(j)+'&numOfRows=500&type=json'
  # url ë¶ˆëŸ¬ì˜¤ê¸°
  response = requests.get(url) 

  # ë°ì´í„° ê°’ ì¶œë ¥í•´ë³´ê¸°
  contents = response.text

  # ë¬¸ìì—´ì„ jsonìœ¼ë¡œ ë³€ê²½
  #json_ob = json.loads(contents) 
  json_ob = parse_re(contents)

  # í•„ìš”í•œ ë¶€ë¶„ë§Œ ì¶”ì¶œ
  counts = json_ob['count']
  print(counts)
  
  # countslistì— append
  countslist = countslist.append(counts)

countslist = [30218,27820,29050,27414,28330,27976,28306,27766,27380,29116,27846,28770]

"""## for ë¬¸ ì‚´ì§ ì¶”ê°€"""

import pandas as pd
from pandas.io.json import json_normalize
import requests
import pprint
import json

# url ì…ë ¥ (https ë§ê³  httpë¡œ ìˆ˜ì •)

#dtype=2,month=1
#count=OOOO
#pageNo=13
#numOfRows=500

#dtype=2,month=2
#count=OOOO
#pageNo=count/numOfRows
#numOfRows=500

dataframe = pd.DataFrame(columns=['spot_id', 'month', 'day', 'direction', 'vehicle_type1', 'vehicle_type2',
       'vehicle_type3', 'vehicle_type4', 'vehicle_type5', 'vehicle_type6',
       'vehicle_type7', 'vehicle_type8', 'vehicle_type9', 'vehicle_type10',
       'vehicle_type11', 'vehicle_type12', 'total_count'])

# list = [0,1,2,3,4,5] 
## spothcv -> vt
for j in range(1,13): #month
  count = countslist[j]
  pageNo = round(count/500)

  for i in range(pageNo):
    url = 'http://apis.data.go.kr/1613000/KICTopenAPI/vt?serviceKey=LGp4ONLLefBCX516C1Cg%2B6LeQEDqU8iKsXZM9nxG0zPoZ61jkjo9tHIBdJXXoeEzPlJMEqi6SlIvRHYrNU12cA%3D%3D&year=2020&dtype=2&output=json&pageNo={}'.format(i) + '&month={}'.format(j) + '&numOfRows=500&type=json'
    # url ë¶ˆëŸ¬ì˜¤ê¸°
    response = requests.get(url) # ì‹ ë¢°í•  ìˆ˜ ì—†ëŠ” SSL ì¸ì¦ì„œë¡œ ì¸í•´ ë°œìƒ, verify=False êµ¬ë¬¸ ì¶”ê°€

    # ë°ì´í„° ê°’ ì¶œë ¥í•´ë³´ê¸°
    contents = response.text

    # ë¬¸ìì—´ì„ jsonìœ¼ë¡œ ë³€ê²½
    #json_ob = json.loads(contents) ## dtype 2ì—ì„œ ì—¬ê¸°ì„œ ì—ëŸ¬ëœ¸
    json_ob = parse_re(contents)

    # í•„ìš”í•œ ë¶€ë¶„ë§Œ ì¶”ì¶œ
    body = json_ob['traffic']

    # ë°ì´í„°í”„ë ˆì„ìœ¼ë¡œ ë³€í™˜
    dataframe_i = json_normalize(body)

    # ë°ì´í„°í”„ë ˆì„ append
    dataframe = dataframe.append(dataframe_i) #month 1~12 ë‹¤
    dataframe = dataframe.reset_index(drop=True)

    # csv íŒŒì¼ë¡œ ì €ì¥
    #dataframe.to_csv('totalcount_vehicle2020_dtype2.csv',index=False)

"""## í˜¸í˜¸ ì˜¤ë¥˜ ë– ì„œ ê·¸ëƒ¥ ìˆ˜ë™ìœ¼ë¡œ"""

import pandas as pd
from pandas.io.json import json_normalize
import requests
import pprint
import json

# url ì…ë ¥ (https ë§ê³  httpë¡œ ìˆ˜ì •)
# countslist = [30218,27820,29050,27414,28330,27976,28306,27766,27380,29116,27846,28770]

#dtype=2,month=1
#count=30218
#pageNo=61
#numOfRows=500

#dtype=2,month=2
#count=27820
#pageNo=56
#numOfRows=500

dataframe = pd.DataFrame(columns=['spot_id', 'month', 'day', 'direction', 'vehicle_type1', 'vehicle_type2',
       'vehicle_type3', 'vehicle_type4', 'vehicle_type5', 'vehicle_type6',
       'vehicle_type7', 'vehicle_type8', 'vehicle_type9', 'vehicle_type10',
       'vehicle_type11', 'vehicle_type12', 'total_count'])

# list = [0,1,2,3,4,5] 
## spothcv -> vt

for i in range(56):
  url = 'http://apis.data.go.kr/1613000/KICTopenAPI/vt?serviceKey=LGp4ONLLefBCX516C1Cg%2B6LeQEDqU8iKsXZM9nxG0zPoZ61jkjo9tHIBdJXXoeEzPlJMEqi6SlIvRHYrNU12cA%3D%3D&year=2020&dtype=2&output=json&pageNo={}'.format(i) + '&month=2&numOfRows=500&type=json'
  # url ë¶ˆëŸ¬ì˜¤ê¸°
  response = requests.get(url) # ì‹ ë¢°í•  ìˆ˜ ì—†ëŠ” SSL ì¸ì¦ì„œë¡œ ì¸í•´ ë°œìƒ, verify=False êµ¬ë¬¸ ì¶”ê°€

  # ë°ì´í„° ê°’ ì¶œë ¥í•´ë³´ê¸°
  contents = response.text

  # ë¬¸ìì—´ì„ jsonìœ¼ë¡œ ë³€ê²½
  #json_ob = json.loads(contents) ## dtype 2ì—ì„œ ì—¬ê¸°ì„œ ì—ëŸ¬ëœ¸
  json_ob = parse_re(contents)

  # í•„ìš”í•œ ë¶€ë¶„ë§Œ ì¶”ì¶œ
  body = json_ob['traffic']

  # ë°ì´í„°í”„ë ˆì„ìœ¼ë¡œ ë³€í™˜
  dataframe_i = json_normalize(body)

  # ë°ì´í„°í”„ë ˆì„ append
  dataframe = dataframe.append(dataframe_i)
  dataframe = dataframe.reset_index(drop=True)