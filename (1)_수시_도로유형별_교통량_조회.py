# -*- coding: utf-8 -*-
"""(1) ìˆ˜ì‹œ ë„ë¡œìœ í˜•ë³„ êµí†µëŸ‰ ì¡°íšŒ

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1_aNU7TfkyzxeLp_pWtGrMfc6FQacI6F_

## ì˜¤í”ˆ API crawlering

### ê³µê³µë°ì´í„° í˜¸ì¶œí•˜ê³  ë°ì´í„° ë½‘ê¸°

### ìˆ˜ì‹œ ë„ë¡œìœ í˜•ë³„ êµí†µëŸ‰ ì¡°íšŒ

https://www.data.go.kr/iim/api/selectAPIAcountView.do
"""

! pip install xmltodict

"""dtype = 1ì¼ë•Œ count = 24240 <br/>
dtype = 2ì¼ë•Œ count = 50592 <br/>
dtype = 3ì¼ë•Œ count = 58224 <br/>
dtype = 4ì¼ë•Œ count =<br/>
dtype = 5ì¼ë•Œ count = 17472 <br/>
"""

import pandas as pd
from pandas.io.json import json_normalize
import requests
import pprint
import json

# url ì…ë ¥ (https ë§ê³  httpë¡œ ìˆ˜ì •)

#count=24240
#pageNo=49
#numOfRows=500

#count=50592
#pageNo=102
#numOfRows=500

#count=58224 ~ í• ì°¨ë¡€
#pageNo=117
#numOfRows=500

#

#count=17472
#pageNo=35
#numOfRows=500


dataframe = pd.DataFrame(columns=['spot_id', 'direction', 'hour', 'vehicle_type1', 'vehicle_type2',
       'vehicle_type3', 'vehicle_type4', 'vehicle_type5', 'vehicle_type6',
       'vehicle_type7', 'vehicle_type8', 'vehicle_type9', 'vehicle_type10',
       'vehicle_type11', 'vehicle_type12', 'total_count'])

# list = [0,1,2,3,4,5] 

for i in range(35):
  url = 'http://apis.data.go.kr/1613000/KICTopenAPI/spothcv?serviceKey=^.^&year=2020&dtype=5&output=json&pageNo={}'.format(i) + '&numOfRows=500&type=json'

  # url ë¶ˆëŸ¬ì˜¤ê¸°
  response = requests.get(url) # ì‹ ë¢°í•  ìˆ˜ ì—†ëŠ” SSL ì¸ì¦ì„œë¡œ ì¸í•´ ë°œìƒ, verify=False êµ¬ë¬¸ ì¶”ê°€

  # ë°ì´í„° ê°’ ì¶œë ¥í•´ë³´ê¸°
  contents = response.text

  # ë¬¸ìì—´ì„ jsonìœ¼ë¡œ ë³€ê²½
  json_ob = json.loads(contents) ## dtype 2ì—ì„œ ì—¬ê¸°ì„œ ì—ëŸ¬ëœ¸
                                 ## ì—ëŸ¬ê°€ ë‚ ë•Œë„ ìˆê³  ì•ˆë‚ ë•Œë„ ìˆìŒ, ì„œë²„ ë¶ˆì•ˆì • ë¬¸ì œê±°ë‚˜
                                 ## íŠ¸ë˜í”½ í•œë„ ì´ˆê³¼ì¼ ê°€ëŠ¥ì„±ë„ ìˆìŒ

  # í•„ìš”í•œ ë¶€ë¶„ë§Œ ì¶”ì¶œ
  body = json_ob['traffic']

  # ë°ì´í„°í”„ë ˆì„ìœ¼ë¡œ ë³€í™˜
  dataframe_i = json_normalize(body)

  # ë°ì´í„°í”„ë ˆì„ append
  dataframe = dataframe.append(dataframe_i)
  dataframe = dataframe.reset_index(drop=True)

dataframe

dataframe.to_csv('dataframe2020(5).csv',index=False)

dataframe1 = pd.read_csv('dataframe2020(1).csv')
dataframe2 = pd.read_csv('dataframe2020(2).csv')
dataframe3 = pd.read_csv('dataframe2020(3).csv')
dataframe5 = pd.read_csv('dataframe2020(5).csv')

"""#### ì¹¼ëŸ¼ ì¶”ê°€"""

dataframe1['dtype'] = 1
dataframe2['dtype'] = 2
dataframe3['dtype'] = 3
dataframe5['dtype'] = 5

dataframe2020 = pd.concat([dataframe1,dataframe2,dataframe3,dataframe5])
dataframe2020 = dataframe2020.reset_index(drop=True)
dataframe2020 # 150528 * 17

dataframe2020.to_csv('dataframe2020.csv',index=False)

"""## ğŸ’¥"""